<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon</title>
	</head>
	<body>
		<h1>
			<big>
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
		
		<hr>
		
		<h1>
			<a href="http://flaz14.github.io/how-to-disable-policy-kit/how-to-disable-policy-kit.html">
				Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon
			</a>
		</h1>	
		
		<p>
			Здесь "отключить" означает настроить PolicyKit таким образом, чтобы с его помощью нельзя было 
			выполнять административные задачи. Например, удалять пакеты посредством Synaptic (команда 
			<code>synaptic-pkexec</code>) или форматировать диски с помощью GParted (команда 
			<code>gparted-pkexec</code>). Но при этом должна остаться возможность выключать компьютер, 
			менять настройки сетевых подключений и выполнять другие действия, для которых по умолчанию 
			никакие пароли не требуются.
		
		<p>
			Удалить PolicyKit в Linux Mint нельзя (от него зависит пакет <code>cinnamon</code> и многие 
			другие). Но, даже если бы PolicyKit можно было удалить, появилась бы куча проблем: разрешения на 
			выключение компьютера и прочие действия пришлось бы настраивать заново (или с помощью SUID 
			битов, или допиливанием PAM, или каким-нибудь другим образом, ведь старые дистрибутивы 
			обходились без PolicyKit, когда его еще не было).
		
		<p>
			У PolicyKit есть "действия", "правила" и т.д. Каждому такому понятию соответствуют свои конфиги.
			Например, для "действий" есть <code>/usr/share/polkit-1/actions/</code>. Казалось бы, достаточно 
			удалить ненужные файлы. Но они могут создаваться при установке программ (тот же GParted) и при 
			обновлении дистрибутива. Кроме того, с первого раза не так просто разобраться в этом ворохе 
			конфигов. Для "правил" есть  <code>/usr/share/polkit-1/rules.d/</code>, но и там темный лес.
		
		<p>
			А вот конфиги в <code>/etc</code> - именно то, что нужно 
			<sup id="footnote-1-top"><a href="#footnote-1-bottom">[1]</a></sup>. Итак:
			<ol>
				<li>
					Создаем фиктивную группу <i>mypolkit</i>:
					<p>
						<code>sudo addgroup mypolkit</code>

				<li>
					Правим файл 
					<code>/etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf</code> 
					(в нем нет предупреждений вроде <i>DO NOT EDIT THIS FILE, it will be overwritten 
					on update.</i>). Не забываем предварительно сделать его бэкап, но только не в 
					этот же каталог, а в другой, например, <code>/backups</code>, иначе файл-бэкап 
					может быть воспринят как еще один конфиг. Отредактированный конфиг должен 
					выглядеть так:
<p>
<pre>
[Configuration]
AdminIdentities=unix-group:mypolkit
</pre>	
			</ol>
			
		<p>
			В итоге PolicyKit будет запрашивать пароль не вызвавшего его пользователя, а пароль <i>root</i>.
			Но, поскольку пользователя <i>root</i> в Ubuntu (а следовательно, и в Linux Mint) нет, то, какой 
			пароль ни вводи, он не подойдет 
			<sup id="footnote-2-top"><a href="#footnote-2-bottom">[2]</a></sup> 
			<sup id="footnote-3-top"><a href="#footnote-3-bottom">[3]</a></sup>.
			<p>
				<img alt="Окно ввода пароля PolicyKit" src="policy-kit-enter-password-window.png" width="480px">
		
		<p>
			&#9135;&#9135;&#9135;&#9135;&#9135;
			<ol>
				<li id="footnote-1-bottom">
					<p>
						<a href="#footnote-1-top" title="Перейти к основному тексту">&uarr;</a> 
						Для большей уверенности можно удалить конфиг 
						<code>/etc/pam.d/polkit-1</code>. Но, как выяснилось, 
						наличие/отсутствие этого конфига не влияет на запрашиваемый 
						PolicyKit пароль. Так что лучше оставить.

				<li id="footnote-2-bottom">
					<p>
						<a href="#footnote-2-top" title="Перейти к основному тексту">&uarr;</a> 
						После описанных выше манипуляций нельзя будет изменить системное время 
						из апплета на панели задач. Но это не проблема: запускаем 
						<code>gksudo cinnamon-settings</code> и меняем что угодно (правда, тут 
						надо быть осторожным, чтобы не испортить другие настройки).
						
				<li id="footnote-3-bottom">
					<p>
						<a href="#footnote-3-top" title="Перейти к основному тексту">&uarr;</a> 
						Если в системе все-таки есть пользователь <i>root</i> (т.е. если он был 
						добавлен вручную), нужно установить для него сложный (лучше - 
						"невзламываемый", длиной около 50 случайных символов) пароль.
			</ol>
			
		<hr>
		
		<h1>
			<big>
				<a href="#" title="Перейти к началу страницы">&uarr;</a>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
	</body>
</html>
