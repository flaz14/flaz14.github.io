<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>"Креативные" сообщения в Skype. Часть 2</title>
	</head>
	<body>
		<h1>
			<big>
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
		
		<hr>
		
		<h1>
			<a href="http://flaz14.github.io/skype-extra-messaging/skype-extra-messaging-part-2.html">
				"Креативные" сообщения в Skype. Часть 2
			</a>
		</h1>
		
		<h3>[2017, Март]</h3>
		
		<h3>
			<a href="skype-extra-messaging-part-1.html">Часть 1</a>
			|
			<a href="skype-extra-messaging-part-3.html">Часть 3</a>
			|
			<a href="тут будет ссылка на исходный код">
				Исходный код
			</a>
		</h3>
		
		<h2>Что может пойти не так</h2>
		
		<p>
			<ol>
				<li>
					Ограниченная длина строки сообщения
					
					Если строка в сообщении [1]  очень длинная, то Skype разбивает ее по границам слов (т.е. по пробелам).
					Если же строка не содержит пробелов и при этом не помещается по ширине в область сообщений, Skype 
					все равно разбивает такую строку [2]. Т.о. нужно использовать строки умеренной длины. Опытным путем
					было выяснено, что 7 смайликов помещаются и отображаются без всяких переносов.
					
				<li>
					Ограниченная длина всего сообщения
					
					Если сообщение очень длинное, то Skype обрезает его до определенного количества символов и вместо 
					выброшенных ставит многоточие <tt>...</tt> (по крайней мере, в версии для Linux). Возможно, в Web-приложении 
					ограничений на длину сообщения нет (бесконечная прокрутка все-таки). Опытным путем было выяснено, 
					что в версии для Linux  (при использование буквы размером 7x7 смайликов) ограничение - 327 строк, 
					а уже 328-ая строка уже урезается (смайлики отображаются в виде простого текста) и добавляется многоточие.
					В Web-версии это длинное сообщение вообще не отобразилось (непонятно, был ли это глюк синхронизации
					аккаунтов, или же у Web-версии еще есть какие-то проверки).
					
					
					
				
				
			</ol>
		
			Вообще, ограничения могут быть разными для разных версий Skype. Кроме того, они могут меняться, как говорится,
			без предварительного уведомления пользователей. 7x7  - 
			вполне нормальный размер для растрового шрифта. Тем более, если мы собираемся собирать буквы вручную: меньше
			работы (хотя плавность линий при таком низком "разрешении" будет страдать).
			
		<p>
			Приготовим сначала заготовку. Она будет состоять из семи строк по семь дефисов в каждой. Затем будем собирать
			буквы. В качестве "белого" пикселя оставим <b>-</b>, а в качестве "черного" возьмем <b>*</b>. Оставим по одной
			пустой строке сверху и снизу, чтобы после соедениния букв в слово они не слипались (и не только для этого - 
			лишний ряд окажется нелишним для особенных букв, таких как <b>Й</b> ). Вот, к примеру, буква 
			<i>А</i>:
			
<pre>
-------
--***--
-*---*-
-*****-
-*---*-
-*---*-
-------
</pre>	
		
		<p>
			Применительно к букве <b>А</b> получилось сделать плавные очертания.
			По возможности позаботимся о плавных очертаниях (если вообще можно применить это слово). От буквы <b>Ё</b>
			пришлось отказаться. От Й отказываться нельзя. Так что поставим на месте "шляпки" просто один черный пиксель.
			Некоторые буквы, такие как <b>Ж</b>, получилсь некрасивыми. А буквы <b>Ш</b> и <b>Щ</b> - неконтрастными, "хвостик",
			характертный для <b>Щ</b> получился величиной всего 1 пиксель! Как бы то ни было, получившийся
			алфавит можно
			увидеть в файле abc.txt !!!тут будет ссылка!!! Или же взять готовый шрифт. Или же сгенерировать с каким 
			угодно стиле на сайтах вроде 
			<a href="http://patorjk.com/software/taag/#p=display&f=Graffiti&t=Type%20Something%20">
				Text to ASCII Art Generator (TAAG)</a>. 
				
		<h2>Переводим текст в смайлики</h2>
		
		<p>
			Наверное, самый простой путь - взять в качестве "цвета" фона обычный смайлик <b>:)</b>, а в качестве "цвета"
			шрифта - мишку <b>(hug)</b>. 
						Собственно, добавить смайлики несложно. Достаточно заменить везде в тексте <b>-</b> на <b>:)</b>, а <b>*</b>
			на <b>(hug)</b>. 
			
			Наверное, это наиболее уместные смайлики (по крайней мере, при написании приветствия).
			 Потому что обычный смайлик - самый
			распространенный, и мишка подходит. Но самое главное, что цвет мишки (в основном бурый) и цвет смайлика 
			(в осносном желтый) контрастируют друг с другом. И "буква" хорошо читается. Сравните буквы "П", набранные контрастными
			смайликами и неконтрастными смайликами (см. рисунок 1)
			
		<p>
			Есть еще один нюанс с клиентом для Linux (и для Windows-версии тоже, может быть). Если в самом начале сообщения 
			не поставить перевод строки (<kbd>Shift</kbd> + <kdb>Enter</kdb>), то самый первый ряд "пикселей" останется
			на одной строке со временем отправки сообщения. Эта особенность продемонстрирована на рисунке 2. А вот в 
			Web-приложении все будет выглядеть хорошо
			время отправки сообщения отбражается немного поодаль справа (в Web-приложении в самом начале сообщения нельзя
			втавить перевод строки вообще, т.е вставить можно, но он не отобразиться. Видимо, перед самой отправкой  
			пустые строки в самом начале 
			и в конце сообщения отбрасываются).
			
		<h2>И все-таки</h2>	
		
		<p>
			Нужно помнить обо всех ограничениях. Иначе тщательно составленное сообщение покорежится и потеряет эффектный вид.
			Конечно же, можно все это автоматизировать: и автоматическую замену "пикселей" на смайлики, и поддержку 
			"цветов", и собственно отправку (ну не копипастить же каждое новое слово из текстового редактора в Skype).
			И программу автоматизации нужно будет хорошенько отладить, проверить на нестандартных данных и т.д. А вообще, 
			написание бота для Skype - отдельная задача. И там есть где развернуться.
			
			
		<p>
			Идеальным вариантом был бы автоматический подбор оптимального размера шрифта. Т.е. с помощью специального
			бота, работающего от имени тестового аккаунта, отправляются сообщения разной длины. А затем бот "захватывает"
			реально отображаемый текст и  методом двоичного
			поиска выбирается самая большая длина. По сути дела, выбирается наибольшее разрешение символа, т.е. может быть
			не 7x7, а скажем, 10x10. Ну и шрифты можно генерировать вручную (хотя может получиться так, что подобрать уже
			растровый шрифт для матрицы 10x10 будем посложнее, чем для матрицы 7x7).
		
		<h2>Все началось с проветривания</h2>
		
		<p>
			Свежий и приятный воздух в офисе - избитая тема. О предстоящем проветривании в Skype отравляется сообщение, 
			так уж у нас сложилось. Одинаковые сообщения вроде <tt>проветривание?</tt> быстро надоели. Хочется написать 
			то же, только необычным способом. Чтобы кто-нибудь в комнате улыбнулся... Сначала я отправлял сообщения 
			вроде <tt>?еинавиртеворп</tt>, <tt>ПрОвЕтРиВаНиЕ?</tt> и т.п. Или писал слово на нескольких строках, 
			например:
<pre>
   Р     В      Т       И       А       И       ?
П     О     Е       Р       В       Н       Е
</pre>			
		
		<p>
			или			
<pre>
П
  Р
    О
       В
          Е
              Т
                  Р
                     И
                        В
                           А
                               Н
                                  И
                                      Е
                                           ?
</pre>

		<p>
			Но креатив в этом направлении быстро закончился. Так что я начал искать другие пути.
		
		<h2>Псевдографика и ASCII-арт не подходят</h2>
		
		<p>
			Первое, о чем я подумал - это псевдографика и ASCII-арт. Казалось бы, возможности огромные. Можно 
			воспользоваться готовым генератором, который поможет быстро подобрать стиль текста под настроение. Или же 
			"нарисовать" сообщение вручную. Но в реальности ничего не получается. Дело в том, что в Skype (и в клиенте 
			для Windows, и в клиенте для Linux, и в Web-приложении) не используется моноширинный шрифт. Из-за этого 
			буквы "едут". Возьмем, к примеру, следующий псевдографический текст:			
<pre>
 _   _   _   _   _ ___  _        _   _             _   __
| | |_| | | |_) |_  |  |_) | /| |_)  _|  |_| | /| |_  (  )
| | |   |_| |_) |_  |  |   |/ | |_) |_|  | | |/ | |_    /
                                       `                .
</pre>			
			
		<p>
			На этой страничке слово отображается нормально в силу использования преформатированного текста, который 
			всегда выводится на экран посредством моноширинного шрифта. Но в Skype-клиентах все по-другому. На 
			<a href="#illustration-1">рисунке 1</a>	приведено то же сообщение в Linux-версии 
			<sup id="footnote-1-top"><a href="#footnote-1-bottom">[1]</a></sup>. А на 
			<a href="#illustration-2">рисунке 2</a> - в Web-приложении. 
			
		<h4 id="illustration-1">Рисунок 1 - Вид псевдографического сообщения в Linux-версии</h4>
		<p>
			<img src="illustrations/pseudo-graphics-linux-version.png" width="480px" 
			alt="фрагмент скриншота окна Skype v. 4.3.0.37, работающем в графическом окружении Cinnamon">
		
		
		<h4 id="illustration-2">Рисунок 2 - Вид псевдографического сообщения в Web-приложении</h4>
		<p>
			<img src="illustrations/pseudo-graphics-web-app.png" width="480px" 
			alt="фрагмент скриншота Web-приложения Skype, работающем в браузере Firefox">
			
		<p>
			Комментарии, как говорится, излишни.
		
		<h2>Хитрости с Web-приложением</h2>
		
		<p>
			Про <strong>Inspect Element</strong> все знают. Заходим в <em>Inspector</em> и делаем все, что захотим. Я 
			ничего лучше не придумал, чем окружить элемент <code>&lt;p&gt;</code>, внутри которого содержится текст 
			сообщения, тэгом <code>&lt;font&gt;</code> с указанием использовать шрифт <em>Courier</em> (как всем 
			известно, он моноширинный). Манипуляции в <em>Inspector</em>'е продемонстрированы на 
			<a href="#illustration-3">рисунке 3</a>. А их результат - на <a href="#illustration-4">рисунке 4</a>.
			
		<h4 id="illustration-3">Рисунок 3 - Изменение шрифта сообщения в браузере Mozilla Firefox</h4>
		<p>
			<img src="illustrations/inspector.png" width="640px"
			alt="фрагмент скриншота Firefox с выделенным элементом DOM-модели, соответствующим сообщению в Skype Web">
		
		<h4 id="illustration-4">
			Рисунок 4 - Вид псевдографического сообщения после замены шрифта на моноширинный вручную
		</h4>
		<p>
			<img src="illustrations/tweaked-message.png" width="480px"
			alt="фрагмент скриншота Firefox с сообщением на страничке после манипуляций в Inspector'e">
			
		<p>
			Выглядит намного лучше. По крайней мере, буквы не поехали. Конечно, если закрыть вкладку, тюнинг пропадет.
			При желании можно сделать изменение шрифта постоянным. И еще много чего можно сделать (например, область 
			сообщений - пошире, а полосу прокрутки - потолще). Впрочем, запуск сайта в Web-браузере с целью имитации 
			поведения настольной программы - это отдельная тема.
		
		<h2>Unicode спешит на помощь</h2>
		
		<p>
			А что, если вместо скучных букв английского и русского алфавитов использовать что-нибудь особенное? 
			Например, возьмем сообщение, набранное чем-то отдаленно напоминающим славянскую вязь:
<pre>

ⲠⲢⲞⲂⲈⲦⲢ𐌵ⲂⲀⲎ𐌵Ⲉ?

</pre>			
		
		<p>
			И посмотрим, как оно будет выглядеть в версии для Linux (<a href="#illustration-5">рисунок 5</a>) и в 
			Web-приложении (<a href="#illustration-6">рисунок 6</a>)
			
		<h4 id="illustration-5">Рисунок 5 - Вид сообщения, состоящего из "редких" символов, в Linux-версии</h4>
		<p>
			<img src="illustrations/unicode-simple-linux-version.png" width="480px"
			alt="скриншот Linux-версии; используется шрифт, установленный в графическом окружении по умолчанию, а именно 
			Ubuntu">
			
		<h4 id="illustration-6">Рисунок 6 - Вид сообщения, состоящего из "редких" символов, в Web-приложении</h4>
		<p>
			<img src="illustrations/unicode-simple-web-app.png" width="480px"
			alt="скриншот Web-приложения, запущенного в браузере Firefox; используется непонятно какой шрифт">
		
		<p>
			Вполне нормальный результат. Но не все так просто. То, что нестандартные (т.е. редко употребляемые) символы 
			Unicode нормально отображаются в Linux-версии - это заслуга <em>библиотеки Qt</em> и <em>шрифта Ubuntu</em>.
			Конечно, сотня-другая букв в шрифте Ubuntu превращается в кракозябры, но это уж очень редкие символы. В 
			Web-версии тоже все ОК. Firefox ведь корректно обрабатывает Unicode. Но будет ли текст отображаться 
			правильно в настольном приложении для Windows? Не знаю (просто не пробовал: в виртуальной машине только 
			Windows XP). Или если Web-приложение открыть в браузере Internet Explorer 11 (в виртуальной машине установлен
			IE 6 - открывать в нем Skype Web смысла нет)?
			
		<p>
			Как-то раз я столкнулся с глюком. Есть такие символы (в разделе <em>Miscellaneous Technical</em>): 
			<tt>⍇</tt> и <tt>⍈</tt>. Я отправил пару этих символов (два прямоугольника с расходящимися стрелками 
			символизировали распахивание окон) в общий чат. У меня в Linux-версии сообщение отобразилось нормально, как 
			на <a href="#illustration-7">рисунке 7</a>.
			
		<h4 id="illustration-7">Рисунок 7 - Вид сообщения, состоящего из "очень редких" символов, в Linux-версии</h4>
		<p>
			<img src="illustrations/unicode-ok-linux-version.png" width="480px"
			alt="скришнот Skype для Linux, с Unicode все в порядке">
			
		<p>
			В настольном Skype на Windows 7 прямоугольники тоже появились, но без стрелок. Скриншота нет, к сожалению. 
			Но я хорошо помню, что прямоугольники были пустые. Почему пустые? Неизвестно. То ли в шрифте, который 
			используется в Windows, этих символов нет. То ли что-то с кодировкой. В любом случае, прямоугольники без 
			стрелок были похожи на своих собратьев из MS Word (см. <a href="#illustration-8">рисунок 8</a>).
			
		<h4 id="illustration-8">
			Рисунок 8 - Неизвестные символы в MS Word отображаются в виде пустых прямоугольников
		</h4>
		<p>
			<img src="illustrations/ms-word-invalid-symbols.jpg" width="640px"
			alt="фрагмент скриншота MS Word, взятый с какого-то сайта, найден в Google">
	
		<p>
			По идее, если в Windows брать Unicode-символы только из окна вставки символа MS Word, то глюков быть не 
			должно. Я же копипастил символы из программы <b>GNOME Character Map v. 3.10.1</b>.

		<h2>Немного псевдографики все же можно сделать</h2>
		
		<p>
			Воспользуемся Unicode-символами из группы <em>Box Drawing</em>. Все они имеют одинаковую ширину. А вместо 
			пробелов возьмем тонкие штриховые линии. Они не сильно режут глаз и в то же время помогают удержать буквы на
			месте.
<pre>

┏┓┏┓┏┓┏┓┈┏━┈━┳━┏┓╻┈╻┏┓┈┏┓╻┈╻╻┈╻┏━┈╭─╮
┃┃┣┛┃┃┣┻┓┣━┈┈┃┈┣┛┃╱┃┣┻┓┣┨┣━┨┃╱┃┣━┈┈╭╯
╹╹╹┈┗┛┗━┛┗━┈┈╹┈╹┈╹┈╹┗━┛╹╹╹┈╹╹┈╹┗━┈┈╸

</pre>
	
		<p>
			В версии для Linux слово отображается нормально (см. <a href="#illustration-9">рисунок 9</a>). В 
			Web-приложении, работающем в браузере Google Chrome, тоже все ОК. А вот в браузере Mozilla Firefox шрифт 
			какой-то странный. Почему-то у буквы <b>П</b> вместо двух "ножек" появилось три. В общем, можете сами 
			увидеть разницу на <a href="#illustration-10">рисунке 10</a>.
			
		<h4 id="illustration-9">Рисунок 9 - Unicode-псевдографика в Linux-версии</h4>
		<p>
			<img src="illustrations/unicode-pseudo-graphics-ok-linix-version.png" width="480px"
			alt="в Skype для Linux все нормально">
		
		<h4 id="illustration-10">
			Рисунок 10 - Unicode-псевдографика в Web-приложении (браузеры Chrome и Firefox соответственно)
		</h4>
		<p>
			<img src="illustrations/unicode-pseudo-graphics-ok-web-app-chrome.png" width="480px"
			alt="в Web-приложении, работающего в Chome, буквы на своих местах">
		<p>
			<img src="illustrations/unicode-pseudo-graphics-fail-web-app-firefox.png" width="480px"
			alt='в Web-приложении, работающем в Firefox, буквы "съехали"'>

		<p>
			Вот еще вариант, только с использованием общепринятых символов:
<pre>

П Р () В Е Т Р |/| В /-\ |-| |/| Е ?

</pre>

		<p>
			Уродливо, конечно. Может, для коротких слов получится что-нибудь подобрать...

		<h2>Смайлики - наше все</h2>
		
		<p>
			В последней версии Skype (в том числе в Web-приложении) много смайликов. Все они анимированные: подмигивают, 
			растягиваются в улыбке и т.д. Если смайликов в сообщении от одного до трех, и нет текста (пробелы не 
			считаются), то смайлики отображаются большими, и анимация разыгрывается на полную. Если смайликов в 
			сообщении более трех или же если в сообщении наряду со смайликом присутствует текст, то смайлики уменьшаются
			в размерах и едва мерцают. До конца с закономерностями анимации я не разбирался. Главное вот что: все 
			смайлики во всех версиях Skype имеют одинаковый (относительно друг друга) размер. Т.е. обладают тем же 
			свойством, что и буквы моноширинного шрифта. Можно писать сообщения смайликами. Попробуем следующее:
<pre>

:):):):):):):)
:)(hug)(hug)(hug)(hug)(hug):)
:)(hug):):):)(hug):)
:)(hug):):):)(hug):)
:)(hug):):):)(hug):)
:)(hug):):):)(hug):)
:):):):):):):)

:):):):):):):)
:)(hug)(hug)(hug)(hug):):)
:)(hug):):):)(hug):)
:)(hug)(hug)(hug)(hug):):)
:)(hug):):):):):)
:)(hug):):):):):)
:):):):):):):)

:):):):):):):)
:)(hug):):):)(hug):)
:)(hug):):)(hug)(hug):)
:)(hug):)(hug):)(hug):)
:)(hug)(hug):):)(hug):)
:)(hug):):):)(hug):)
:):):):):):):)

:):):):):):):)
:)(hug)(hug):):):):)
:)(hug):)(hug):):):)
:)(hug)(hug)(hug)(hug):):)
:)(hug):):):)(hug):)
:)(hug)(hug)(hug)(hug):):)
:):):):):):):)

:):):):):):):)
:)(hug)(hug)(hug)(hug)(hug):)
:)(hug):):):):):)
:)(hug)(hug)(hug)(hug)(hug):)
:)(hug):):):):):)
:)(hug)(hug)(hug)(hug)(hug):)
:):):):):):):)

:):):):):):):)
:)(hug)(hug)(hug)(hug)(hug):)
:):):)(hug):):):)
:):):)(hug):):):)
:):):)(hug):):):)
:):):)(hug):):):)
:):):):):):):)

</pre>	
			
		<p>
			В Web-приложении такое сообщение отобразится как на <a href="#illustration-11">рисунке 11</a>.
		
		<h4 id="illustration-11">Рисунок 11 - Пример сообщения, состоящего из смайликов</h4>
		<p>
			<img src="illustrations/smiley-text-example.png" width="100px"
			alt='скриншот сообщения в Web-приложении; сделан в маленьком масштабе, чтобы было видно все слово; "буквы" 
			расположены по вертикали'>
		
		<p>
			Присмотримся внимательно к отдельно взятому символу (см. <a href="#illustration-12">рисунок 12</a>)
		
		<h4 id="illustration-12">Рисунок 12 - Буква "П", собранная из смайликов</h4>
		<p>
			<img src="illustrations/one-letter-zoom.png" width="320px"
			alt="буква, собранная из смайликов, при большом увеличении">
		
		<p>
			Как видим, буква имеет размер 7x7 смайликов. 7 смайликов по горизонтали помещаются в область сообщений и не
			переносятся на следующую строку. Вообще, у смайликового текста много возможностей. И ограничений тоже. О них
			и о составлении алфавита (вручную) пойдет речь в <a href="skype-extra-messaging-part-2.html">части 2</a>.
		
		<p>
			__________
			<ol>
				<li id="footnote-1-bottom">
					<p>
						<a href="#footnote-1-top" title="Перейти к основному тексту">&uarr;</a> 
						(как известно, нажатие Enter приводит к отправке сообщения; чтобы начать новую строку
						нужно нажать Shitf + Enter).
						
				<li id="footnote-2-bottom">
					<p>
						<a href="#footnote-2-top" title="Перейти к основному тексту">&uarr;</a> 
						"Разбивает строку" означает здесь, что Skype только отображает одну длинную строку на нескольких
						строках. Но Skype не вставляет символ(ы) возврата каретки/переноса на новую строку. Т.е. если 
						в области сообщений выделить строку и скопировать ее в буфер обмена, она "вытянется".
			</ol>
			
		<hr>
		
		<h1>
			<big>
				<a href="#" title="Перейти к началу страницы">&uarr;</a>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
	</body>
</html>
