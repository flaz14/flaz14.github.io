<html>
	<head>
		<title>Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<head>
	<body>
		<h1>Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon</h1>
		<p>
		Здесь "отключить" означает настроить PolicyKit таким образом, чтобы с его помощью нельзя было выполнять административные задачи. Например, удалять пакеты посредством Synaptic (команда <code>synaptic-pkexec</code>) или форматировать диски с помощью GParted (команда <code>gparted-pkexec</code>). Но при этом должна остаться возможность выключать компьютер, менять настройки сетевых подключений и выполнять другие действия, для которых по умолчанию никакие пароли не требуются.
		</p>
		<p>
		Удалить PolicyKit в Linux Mint нельзя (от него зависит пакет <code>cinnamon</code> и многие другие). Но, даже если бы PolicyKit можно было удалить, появилась бы куча проблем: разрешения на выключение компьютера и прочие действия пришлось бы настраивать заново (или с помощью SUID битов, или допиливанием PAM, или каким-нибудь другим образом, ведь старые дистрибутивы обходились без PolicyKit, когда его еще не было).
		</p>
		<p>
		У PolicyKit есть "действия", "правила" и т.д. Каждому такому понятию соответствуют свои конфиги. Например, для "действий" есть <code>/usr/share/polkit-1/actions/</code>. Казалось бы, достаточно удалить ненужные файлы. Но они могут создаваться при установке программ (тот же GParted) и при обновлении дистрибутива. Кроме того, с первого раза не так просто разобраться в этом ворохе конфигов. Для "правил" есть  <code>/usr/share/polkit-1/rules.d/</code>, но и там темный лес.
		</p>
		<p>
		А вот конфиги в <code>/etc</code> - именно то, что нужно. Итак:
		<ol>
			<li>
			Создаем фиктивную группу <i>mypolkit</i>:
			<p>
				<code>sudo addgroup mypolkit</code>
			</p>
			</li>
			<li>
			Правим файл <code>/etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf</code> (в нем нет предупреждений вроде <i>DO NOT EDIT THIS FILE, it will be overwritten on update.</i>). Не забываем предварительно сделать его бэкап, но только не в этот же каталог, а в другой, например, <code>/backups</code>, иначе файл-бэкап может быть воспринят как еще один конфиг. Отредактированный конфиг должен выглядеть так:
			<p>
				<code>[Configuration]</code><br>
				<code>AdminIdentities=unix-group:mypolkit</code>
			</p>
			</li>
		</ol>
		</p>
		<p>
		В итоге, PolicyKit будет запрашивать пароль не вызвавшего его пользователя, а пароль root. Но, поскольку пользователя root в Ubuntu (а следовательно, и в Linux Mint) нет, то, какой пароль ни вводи, он не подойдет.<br>
		<img src="окно ввода пароля.png"/>
		</p>
		<hr/>
		<p>
		<strong>P.S.</strong> Для большей уверенности можно еще удалить конфиг <code>/etc/pam.d/polkit-1</code>. Но, как выяснилось, наличие / отсутствие этого конфига не влияет на запрашиваемый PolicyKit пароль. Так что лучше оставить.
		</p>
		<p>
		<strong>P.S.2</strong> После описанных выше манипуляций нельзя будет изменить системное время из апплета на панели задач. Но это не проблема: запускаем <code>gksudo cinnamon-settings</code> и меняем что угодно (правда, тут надо быть осторожным, чтобы не испортить другие настройки).
		</p>
	</body>
</html>
