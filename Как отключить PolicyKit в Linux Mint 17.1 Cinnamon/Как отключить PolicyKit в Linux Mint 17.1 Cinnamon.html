<html>
	<head>
		<title>Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<head>
	<body>
		<table align="center">
			<tr>
				<td>
					<a href="/" title="Перейти на главную страницу">
						<font size="+3">&#8962;</font>
					</a>
				</td>
			</tr>
		</table>
		<hr/>
		<a href="?">
			<h1>Как "отключить" PolicyKit в Linux Mint 17.1 Cinnamon</h1>
		</a>
		<p>
			Здесь "отключить" означает настроить PolicyKit таким образом, чтобы с его помощью нельзя было выполнять административные задачи. Например, удалять пакеты посредством Synaptic (команда <code>synaptic-pkexec</code>) или форматировать диски с помощью GParted (команда <code>gparted-pkexec</code>). Но при этом должна остаться возможность выключать компьютер, менять настройки сетевых подключений и выполнять другие действия, для которых по умолчанию никакие пароли не требуются.
		</p>
		<p>
			Удалить PolicyKit в Linux Mint нельзя (от него зависит пакет <code>cinnamon</code> и многие другие). Но, даже если бы PolicyKit можно было удалить, появилась бы куча проблем: разрешения на выключение компьютера и прочие действия пришлось бы настраивать заново (или с помощью SUID битов, или допиливанием PAM, или каким-нибудь другим образом, ведь старые дистрибутивы обходились без PolicyKit, когда его еще не было).
		</p>
		<p>
			У PolicyKit есть "действия", "правила" и т.д. Каждому такому понятию соответствуют свои конфиги. Например, для "действий" есть <code>/usr/share/polkit-1/actions/</code>. Казалось бы, достаточно удалить ненужные файлы. Но они могут создаваться при установке программ (тот же GParted) и при обновлении дистрибутива. Кроме того, с первого раза не так просто разобраться в этом ворохе конфигов. Для "правил" есть  <code>/usr/share/polkit-1/rules.d/</code>, но и там темный лес.
		</p>
		<p>
			А вот конфиги в <code>/etc</code> - именно то, что нужно <sup id="footnote-1-top"><a href="#footnote-1-bottom">[1]</a></sup>. Итак:
			<ol>
				<li>
					Создаем фиктивную группу <i>mypolkit</i>:
					<p>
						<code>sudo addgroup mypolkit</code>
					</p>
				</li>
				<li>
					Правим файл <code>/etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf</code> (в нем нет предупреждений вроде <i>DO NOT EDIT THIS FILE, it will be overwritten on update.</i>). Не забываем предварительно сделать его бэкап, но только не в этот же каталог, а в другой, например, <code>/backups</code>, иначе файл-бэкап может быть воспринят как еще один конфиг. Отредактированный конфиг должен выглядеть так:
					<p>
						<code>
							[Configuration]<br>
							AdminIdentities=unix-group:mypolkit
						</code>
					</p>
				</li>
			</ol>
		</p>
		<p>
			В итоге PolicyKit будет запрашивать пароль не вызвавшего его пользователя, а пароль root. Но, поскольку пользователя root в Ubuntu (а следовательно, и в Linux Mint) нет, то, какой пароль ни вводи, он не подойдет 
			<sup id="footnote-2-top"><a href="#footnote-2-bottom">[2]</a></sup> 
			<sup id="footnote-3-top"><a href="#footnote-3-bottom">[3]</a></sup>.
			<p>
				<img alt="Окно ввода пароля PolicyKit" src="окно ввода пароля.png" width="480px"/>
			</p>
		</p>
		<p>&#9135;&#9135;&#9135;&#9135;&#9135;</p>
		<ol>
			<li id="footnote-1-bottom">
				<p>
					<a href="#footnote-1-top">&uarr;</a> Для большей уверенности можно удалить конфиг <code>/etc/pam.d/polkit-1</code>. Но, как выяснилось, наличие/отсутствие этого конфига не влияет на запрашиваемый PolicyKit пароль. Так что лучше оставить.
				</p>
			</li>
			<li id="footnote-2-bottom">
				<p>
					 <a href="#footnote-2-top">&uarr;</a> После описанных выше манипуляций нельзя будет изменить системное время из апплета на панели задач. Но это не проблема: запускаем <code>gksudo cinnamon-settings</code> и меняем что угодно (правда, тут надо быть осторожным, чтобы не испортить другие настройки).
				</p>
				
			</li>
			<li id="footnote-3-bottom">
				<p>
					<a href="#footnote-3-top">&uarr;</a> Если в системе все-таки есть пользователь <code>root</code> (т.е. если он был добавлен вручную), нужно установить для него сложный (лучше - "невзламываемый", длиной около 50 случайных символов) пароль.
				</p>
			</li>
		</ol>
		<hr/>
		<table width="100%" align="center">
			<tr>
				<td>
					<a href="#" title="Перейти к началу страницы">
						<font size="+3">&uarr;</font>
					</a>
				</td>
				<td>
					<a href="/" title="Перейти на главную страницу">
						<font size="+3">&#8962;</font>
					</a>
				</td>
			</tr>
		</table>
	</body>
</html>
