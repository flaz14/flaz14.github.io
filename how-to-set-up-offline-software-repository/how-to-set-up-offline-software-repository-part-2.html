<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Как сделать off-line репозиторий ПО для LinuxMint 17.1. Часть 2</title>
	</head>

	<body>
		<h1>
			<big>
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>

		<hr>

		<h1>
			<a href=
		"http://flaz14.github.io/how-to-hide-non-mounted-drives/how-to-hide-non-mounted-drives-part-1.html">
				Как сделать off-line репозиторий ПО для LinuxMint 17.1. Часть 2
			</a>
		</h1>
		
		<h3>[2017, Июнь]</h3>

		<h3>
			<a href="how-to-set-up-offline-software-repository-part-1.html">Часть 1</a>
			|
			<a href="how-to-set-up-offline-software-repository-part-3.html">Часть 3</a>
			|
			<a href="how-to-set-up-offline-software-repository-part-4.html">Часть 4</a>			
			|
			<a href=
		"https://github.com/flaz14/flaz14.github.io/tree/master/this_source_code_does_not_exist_yet">
				Исходный код
			</a>
		</h3>

		<h2></h2>
		
		<p>
			В <a href="how-to-set-up-offline-software-repository-part-1.html#note-apt-get-approach">части 1</a> 
			говорилось, что при использовании <strong>apt-get</strong> для скачивания будут доступны только пакеты, 
			соответствующие архитектуре компьютера, на который они загружаются. Но это не так. Даже "сидя" на 32-х битном
			дистрибутиве, скачать пакеты для 64-х битного дистрибутива. Достаточно добавить маленький суффикс к имени
			пакета.
		
		<p>
			Пусть мы используем LinuxMint 17.1 32bit. Посмотрим, действительно ли это так:
			
			
			Например, чтобы скачать vim для 64-битного дистрибутива можно воспользоваться такой командой:
<pre>
$ dpkg --print-architecture
i386
</pre>

		<p>
			Теперь глянем, пакеты для каких еще архитектур доступны:
<pre>
$ dpkg --print-foreign-architectures
</pre>
		<p>
			И в ответ не получим ничего. Что ж, неудивительно. Если в 64-х битный дистрибутив можно установить 32-х битную
			программу, то наоборот - нет. Придется добавить архитектуру (практического смысла в этом нет, просто сделаем
			это для демонстрации скачивания пакетов):
<pre>
$ sudo dpkg --add-architecture amd64
$ dpkg --print-foreign-architectures
amd64
</pre>
		<p>
			C 64-х битными пакетами вроде бы разобрались. А как насчет архитектур ARM, PowerPC и т.д.? В принципе, пакеты
			для этих архитектур есть в <a href="https://www.debian.org/releases/stable/">репозиториях Debian</a>, но не
			в Ubuntu (и следовательно, LinuxMint). Так что ограничимся <strong>i386</strong> и <strong>amd64</strong>.
		
		<p>
			Скачаем уже что-нибудь, например, текстовый редактор <em>Vim</em> для 64-х битного дистрибутива (не забыв
			перед этим выполнить <code>sudo apt-get update</code>):
<pre>
$ apt-get download vim:amd64
$ ls
vim_2%3a7.4.052-1ubuntu3.1_amd64.deb
</pre>

		<p>
			Для пущей уверенности можно зайти в свежескачанный .deb-файл с помощью Midnight Commander'а !!!тут будет
			ссылка на официальный сайт!!! и убедиться в правильной архитектуре:
			
!!!тут будет скриншот файла INFO!!!

		<p>
			Чтобы скачать не только готовый двоичный пакет, но и исходные тексты придеться сначала добавить соответствующий
			ссылки. Но не в файл <i>/etc/apt/sources.list</i>. В Ubuntu (а следовательно, и LinuxMint) для источников
			ПО есть каталог <i>/etc/apt/sources.list.d</i>. А уже в нем находятся файлы, которые содержат ссылки определенной
			категории (!!!ссылки - неправильный термин, нужно подобрать что-то более подходящее!!!).
			Посмотрим что уже есть:
<pre>
$ ls -alh /etc/apt/sources.list.d/
total 24K
drwxr-xr-x 2 root root 4,0K Apr  2 11:23 .
drwxr-xr-x 6 root root 4,0K Apr  2 11:23 ..
-rw-r--r-- 1 root root   78 May 24  2016 bro.list
-rw-r--r-- 1 root root   59 Nov 27  2014 getdeb.list
-rw-r--r-- 1 root root  140 Apr  2 11:23 mc3man-trusty-media-trusty.list
-rw-r--r-- 1 root root  529 Nov 27  2014 official-package-repositories.list
</pre>

		<p>
			Откуда взялся getdeb.list я не знаю. Да и содержит этот файл единственную строчку, являющуюся комментарием.
			bro.list и mc3man-trusty-media-trusty.list соответствуют репозиториям сторонних пакетов. А вот 
			<i>official-package-repositories.list</i> - это список оригинальных репозиториев (по крайней мере, так следует
			из названия). Посмотрим на содержимое файла:
<pre>
$ cat /etc/apt/sources.list.d/official-package-repositories.list 
# Do not edit this file manually, use Software Sources instead.

deb http://packages.linuxmint.com rebecca main upstream import  #id:linuxmint_main
deb http://extra.linuxmint.com rebecca main #id:linuxmint_extra

deb http://archive.ubuntu.com/ubuntu trusty main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu trusty-updates main restricted universe multiverse

deb http://security.ubuntu.com/ubuntu/ trusty-security main restricted universe multiverse
deb http://archive.canonical.com/ubuntu/ trusty partner
</pre>			
			
		<p>
			Все вполне предсказуемо. Будет логично предположить, что для подключения репозиториев с исходными текстами ПО
			потребуется создать еще один файл внутри каталога <i>/etc/apt/sources.list.d/</i> и напихать в него ссылок.
			Но угрожающий комментарий о нежелательности ручного редактирования файла наводит на мысль задействовать-таки
			утилиту с графическим интерфейсом. Найти и запустить ее не так уж сложно: 
			<code>$ gksudo software-sources</code>. Перед нами предстанет картинка, приведенная на рисунке
			
			!!!тут будет скриншот программы с выделенной галочкой!!!
			
			Ставим флажок напротив <em>Enable source code repositories</em>, закрываем окно и на всякий случай делаем
			в консоли <code>$ sudo apt-get update</code> (это будет надежнее, чем кликать по кнопке <em>Update the cache</em>
			в правом верхнем углу окна уже просто потому, что в консоли мы увидим подробный лог). В выводе должны появиться
			строчки вроде <em>... http://archive.ubuntu.com trusty/main Sources ...</em>.
			
		<p>
			Чтобы скачать исходный текст программы достаточно выполнить такую команду (для примера скачаем исходные тексты
			редактора Vim):
			
<pre>
$ apt-get source vim
</pre>

		<p>
			Посмотрим, что же реально скачалось:
<pre>
$ ls -1
vim-7.4.052
vim_7.4.052-1ubuntu3.1.debian.tar.gz
vim_7.4.052-1ubuntu3.1.dsc
vim_7.4.052.orig.tar.gz
</pre>

		<p>
			Да, то, что надо. Подробно останавливаться на описании скачанного не будем (дополнительные сведения можно
			найти в <code>man apt-get</code>). Очевидно, что указывать архитектуру при скачивании исходных текстов не
			нужно.
			
		<p>
			В целом алгоритм создания собственного репозитория простой:
			1. Cоставляем список архитектур (в нашем случае их будет всего две: <strong>i386</strong> и <strong>amd64</strong>)
			2. Составляем список пакетов для скачивания
			3. Для каждой пары пакет-архитектура выполняем:	apt-get download имя_пакета:архитектура
			4. Для каждого пакета из списка выполняем: apt-get source имя_пакета
				
			Насчет пункта 2
			
			



		
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
		<p>
			Разобьем решение задачи на несколько этапов:
			<ol>
				<li>
					Просмотрим архив Ubuntu начиная с самого верхнего уровня и соберем все ссылки на все файлы.
							
				<li>
					Скачаем файлы. В первую очередь, скачаем контрольные суммы и цифровые подписи, а затем собственно 
					ПО.
					
				<li>
					Проверим контрольные суммы и цифровые подписи.
			</ol>
				
		<p>
			Будем использовать Python. И обращаться к таким программам, как <strong>wget</strong> по мере необходимости.
			Все настройки будем хранить в самом скрипте, в том числе и указание на расположение скачанных файлов. 
			Скачивание будет происходить в автоматическом режиме. Интерактивности не будет. Но мы позаботимся о 
			возможных разрывах Интернет-соединения, докачке файлов и т.п.
			
        <p>
			__________
			<ol>
				<li id="footnote-1-bottom">
					<p>
						<a href="#footnote-1-top" title="Перейти к основному тексту">&uarr;</a> 
						Слово "диск" не совсем уместно. Правильнее было бы сказать "том". Том 
						объединить в том с помощью LVM.

				<li id="footnote-2-bottom">
					<p>
						<a href="#footnote-2-top" title="Перейти к основному тексту">&uarr;</a> 
						Я так и не разобрался, что все это значит: <i>udisks</i>, <i>GVfs</i>, 
			</ol>

		<hr>

		<h1>
			<big>
				<a href="#" title="Перейти к началу страницы">&uarr;</a>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
	</body>
</html>
