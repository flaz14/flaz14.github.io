<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Несмонтированные диски - с глаз долой. Эпилог</title>
	</head>

	<body>
		<h1>
			<big>
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>

		<hr>

		<h1>
			<a 
			href="http://flaz14.github.io/how-to-hide-non-mounted-drives/how-to-hide-non-mounted-drives-epilogue.html">
				Несмонтированные диски - с глаз долой. Эпилог
			</a>
		</h1>
		
		<h3>[2017, Февраль]</h3>
		
		<h3>
			<a href="how-to-hide-non-mounted-drives-part-1.html">Часть 1</a>
			|
			<a href="how-to-hide-non-mounted-drives-part-2.html">Часть 2</a>
			|
			<a href="how-to-hide-non-mounted-drives-part-3.html">Часть 3</a>
			|
			<a href="https://github.com/flaz14/flaz14.github.io/tree/master/how-to-hide-non-mounted-drives/code">
				Исходный код
			</a>
		</h3>

		<h2>Планируем</h2>

		<p>
			Как уже было сказано в <a href="how-to-hide-non-mounted-drives-part-3.html#footnote-2-bottom">части 3</a>, 
			не только файловый менеджер, но и любая другая программа может показывать пользователю несмонтированные 
			тома. Так, Firefox отображает несмонтированные тома на левой панели диалога открытия/сохранения файла. Чтобы 
			продемонстрировать это возьмем все ту же флешку, подключим ее, размонтируем том с меткой <i>8_ext</i>, а том
			с меткой <i>8_ntfs</i> оставим смонтированным. Запустим Firefox, перейдем на какой-нибудь сайт и попробуем 
			сохранить страничку. Увидим картину, приведенную на <a href="#illustration-1">рисунке 1</a>.
		
		<h4 id="illustration-1">
			Рисунок 1 - Firefox отображает несмонтированный том на боковой панели диалога сохранения файла
		</h4>
		<img src="illustrations/firefox-Save-As-dialog-without-hook.png" width="640px">
			
		<p>
			Нет ничего плохого в том, что Firefox показывает несмонтированный том. Но, поскольку я использую Firefox 
			часто, меня это не сильно радует (и особенно расстраивает, когда отображется раздел, зарезервированный для 
			PAM USB, но PAM USB - это отдельная тема).
			
		<p>
			Что ж, поиграем в прятки. "Глобальный" hook сделать можно (например, на уровне модуля ядра). Да, придеться 
			повозиться. Затраченные усилия не оправдают результат. Поэтому воспользуемся известным трюком с перехватом
			функции, расположенной в разделяемой библиотеке. Я не стал смотреть исходный код Firefox, потому что значок 
			извлечения напротив тома с меткой <i>8_ntfs</i> выглядит точно так же (ну почти), как
			<a href="how-to-hide-non-mounted-drives-part-1.html#illustration-1-1">в случае c Nemo</a>. Кроме того, 
			Firefox вроде бы построен на библиотеке Gtk...
			
		<h2>Пробуем</h2>
		
		<p>
			Hook оставим неизменным. Не будем переделывать Makefile. Сделаем лишь новый
			<a 
			href="https://github.com/flaz14/flaz14.github.io/blob/master/how-to-hide-non-mounted-drives/code/firefox">
			скрипт-обертку</a>. Просто скопипастим обертку для Nemo и заменим <tt>nemo</tt> на <tt>firefox</tt>. 
			Остается только поместить его <i>~/bin</i> и сделать исполняемым.

		<p>
			Запустим Firefox посредством обертки и получим картину, приведенную на 
			<a href="#illustration-2">рисунке 2</a>.
		
		<h4 id="#illustration-2">
			Рисунок 2 - Firefox не отображает несмонтированные тома при использовании hook'а
		</h4>
		<img src="illustrations/firefox-Save-As-dialog-with-hook.png" width="640px">
		
		<p>
			Том с меткой <i>8_ext</i> исчез! Результат, как говорится, превзошел все ожидания.
		
		<hr>

		<h1>
			<big>
				<a href="#" title="Перейти к началу страницы">&uarr;</a>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="/" title="Перейти на главную страницу">&#8962;</a>
			</big>
		</h1>
	</body>
</html>
